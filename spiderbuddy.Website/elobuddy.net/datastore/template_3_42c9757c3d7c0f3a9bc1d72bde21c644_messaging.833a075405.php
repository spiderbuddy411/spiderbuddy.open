<?php

return <<<'VALUE'
"namespace IPS\\Theme;\nclass class_core_front_messaging extends \\IPS\\Theme\\Template\n{\n\t\t\tfunction conversation( $conversation, $folders ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n<div class=''>\n\t<p class='ipsResponsive_hideDesktop ipsResponsive_block ipsPos_left ipsType_reset'>\n\t\t<a href='#' data-action='filterBarSwitch' data-switchTo='filterBar' class='ipsButton ipsButton_verySmall ipsButton_light'><i class='fa fa-caret-left'><\/i> <i class='fa fa-navicon'><\/i> &nbsp;\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'messenger_list', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t<\/p>\n\t<a href='#' id='elConvoActions' data-ipsMenu class='ipsPos_right ipsButton ipsButton_verySmall ipsButton_light'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'options', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n <i class='fa fa-caret-down'><\/i><\/a>\n\n\t<ul id='elConvoActions_menu' class='ipsMenu ipsMenu_auto ipsHide'>\n\t\t\nCONTENT;\n\nif ( count( $folders ) > 1 ):\n$return .= <<<CONTENT\n\n\t\t\t<li class='ipsMenu_item ipsMenu_subItems'>\n\t\t\t\t<a href='#' id='elConvoMove'><i class='fa fa-folder'><\/i> \nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'move_message_to', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\n\t\t\t\t<ul id='elConvoMove_menu' class='ipsMenu ipsMenu_auto ipsHide'>\n\t\t\t\t\t\nCONTENT;\n\nforeach ( $folders as $id => $name ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\nCONTENT;\n\nif ( (string) $id !== $conversation->map['map_folder_id'] ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<li class='ipsMenu_item' data-ipsMenuValue='\nCONTENT;\n$return .= htmlspecialchars( $id, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'><a href='\nCONTENT;\n$return .= htmlspecialchars( $conversation->url('move')->csrf()->setQueryString( 'to', $id ), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'>\nCONTENT;\n$return .= htmlspecialchars( $name, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\t\t<\/ul>\n\t\t\t<\/li>\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t<li class='ipsMenu_item'>\n\t\t\t\nCONTENT;\n\nif ( $conversation->map['map_ignore_notification'] ):\n$return .= <<<CONTENT\n\n\t\t\t\t<a href='\nCONTENT;\n$return .= htmlspecialchars( $conversation->url('notifications')->csrf()->setQueryString( 'status', 1 ), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' data-action=\"stopNotifications\">\n\t\t\t\t\t<i class='fa fa-bell'><\/i> \nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'messenger_notifications_on', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\n\t\t\t\t<\/a>\n\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t<a href='\nCONTENT;\n$return .= htmlspecialchars( $conversation->url('notifications')->csrf()->setQueryString( 'status', 0 ), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' data-action=\"stopNotifications\">\n\t\t\t\t\t<i class='fa fa-bell-slash-o'><\/i> \nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'messenger_notifications_off', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\n\t\t\t\t<\/a>\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t<\/li>\n\t\t<li class='ipsMenu_item'>\n\t\t\t<a href=\"\nCONTENT;\n$return .= htmlspecialchars( $conversation->url('leaveConversation')->csrf(), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" data-action=\"deleteConversation\">\n\t\t\t\t<i class='fa fa-trash'><\/i> \nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'messenger_leave', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\n\t\t\t<\/a>\n\t\t<\/li>\n\t<\/ul>\n\n\t<br class='ipsResponsive ipsResponsive_hideDesktop'>\n\t<h1 class='ipsType_pageTitle ipsType_break'>\nCONTENT;\n$return .= htmlspecialchars( $conversation->title, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n <\/h1>\n\t<div class='cMessage_members ipsBox ipsBox_transparent ipsAreaBackground_light ipsPad' id='elConvoMembers_\nCONTENT;\n$return .= htmlspecialchars( $conversation->id, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'>\n\t\t<span class='ipsType_light'><i class='fa fa-user'><\/i> &nbsp;\nCONTENT;\n\n$pluralize = array( $conversation->to_count ); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'members_in_convo', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), FALSE, array( 'pluralize' => $pluralize ) );\n$return .= <<<CONTENT\n<\/span>\n\t\t<ol class='ipsList_inline ipsClearfix ipsSpacer_top ipsSpacer_half'>\n\t\t\t\nCONTENT;\n\n$members = 0;\n$return .= <<<CONTENT\n\n\t\t\t\nCONTENT;\n\nforeach ( $conversation->maps() as $map ):\n$return .= <<<CONTENT\n\n\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"messaging\", \\IPS\\Request::i()->app )->participant( $map, $conversation );\n$return .= <<<CONTENT\n\n\t\t\t\nCONTENT;\n\n$members++;\n$return .= <<<CONTENT\n\n\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\t\nCONTENT;\n\nif ( \\IPS\\Member::loggedIn()->group['g_max_mass_pm'] == 0 OR $members < \\IPS\\Member::loggedIn()->group['g_max_mass_pm']  ):\n$return .= <<<CONTENT\n\n\t\t\t<li data-role='addUserItem'>\n\t\t\t\t<a href='#elInviteMember\nCONTENT;\n$return .= htmlspecialchars( $conversation->id, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_menu' id='elInviteMember\nCONTENT;\n$return .= htmlspecialchars( $conversation->id, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' data-action='inviteUsers' title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'invite_a_member', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n' data-ipsMenu data-ipsMenu-appendTo=\"#elConvoMembers_\nCONTENT;\n$return .= htmlspecialchars( $conversation->id, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" data-ipsMenu-closeOnClick='false' data-ipsTooltip class='ipsButton ipsButton_light ipsButton_narrow ipsButton_large'><i class='fa fa-plus'><\/i> <i class='fa fa-user'><\/i><\/a>\n\t\t\t\t<div class='ipsMenu ipsMenu_wide ipsPad ipsHide' id='elInviteMember\nCONTENT;\n$return .= htmlspecialchars( $conversation->id, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_menu'>\n\t\t\t\t\t<form accept-charset='utf-8' action=\"\nCONTENT;\n$return .= htmlspecialchars( $conversation->url('addParticipant'), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" method=\"post\" data-role='addUser' data-conversation=\"\nCONTENT;\n$return .= htmlspecialchars( $conversation->id, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\">\n\t\t\t\t\t\t<input type='text' class='ipsField_fullWidth' placeholder='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'messenger_invite_placeholder', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n' name=\"member_names\" data-ipsAutocomplete data-ipsAutocomplete-unique data-ipsAutocomplete-dataSource=\"\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=core&module=system&controller=ajax&do=findMember\", null, \"\", array(), 0 ) );\n$return .= <<<CONTENT\n\" data-ipsAutocomplete-queryParam='input' data-ipsAutocomplete-resultItemTemplate=\"core.autocomplete.memberItem\" data-ipsAutocomplete-minLength=\"3\"><br>\n\t\t\t\t\t\t<button class='ipsButton ipsButton_primary ipsButton_fullWidth'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'invite', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/button>\n\t\t\t\t\t<\/form>\n\t\t\t\t<\/div>\n\t\t\t<\/li>\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t<\/ol>\n\t<\/div>\n\t<br>\n\t<div class='ipsBox'>\n\t\t<h2 class='ipsType_sectionTitle ipsType_reset'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'personal_conversation', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h2>\n\t\t<div data-controller='core.front.core.commentFeed' \nCONTENT;\n\nif ( \\IPS\\Settings::i()->auto_polling_enabled ):\n$return .= <<<CONTENT\ndata-autoPoll\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n data-baseURL='\nCONTENT;\n$return .= htmlspecialchars( $conversation->url(), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' \nCONTENT;\n\nif ( $conversation->isLastPage() ):\n$return .= <<<CONTENT\ndata-lastPage\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n data-feedID='messages-\nCONTENT;\n$return .= htmlspecialchars( $conversation->id, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'>\n\t\t\t<div class=''>\n\t\t\t\t\nCONTENT;\n\nif ( $conversation->commentPageCount() > 1 ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<div class=\"ipsButtonBar ipsPad_half ipsClearfix ipsClear\">\n\t\t\t\t\t\t<div data-role=\"tablePagination\">\n\t\t\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"global\", \\IPS\\Request::i()->app, 'global' )->pagination( $conversation->url(), $conversation->commentPageCount(), \\IPS\\Request::i()->page ? intval( \\IPS\\Request::i()->page ) : 1, \\IPS\\core\\Messenger\\Conversation::getCommentsPerPage(), TRUE );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t<\/div>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t<div data-role='commentFeed'>\n\t\t\t\t\t\nCONTENT;\n\nforeach ( $conversation->comments() as $comment ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t{$comment->html()}\n\t\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\t\t<\/div>\n\t\t\t\t\nCONTENT;\n\nif ( $conversation->commentPageCount() > 1 ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<hr class='ipsHr'>\n\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"global\", \\IPS\\Request::i()->app, 'global' )->pagination( $conversation->url(), $conversation->commentPageCount(), \\IPS\\Request::i()->page ? intval( \\IPS\\Request::i()->page ) : 1, \\IPS\\core\\Messenger\\Conversation::getCommentsPerPage(), TRUE );\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t<div data-role='replyArea' class='ipsAreaBackground ipsPad ipsSpacer_top'>\n\t\t\t\t\t{$conversation->commentForm()}\n\t\t\t\t<\/div>\n\t\t\t<\/div>\n\t\t<\/div>\n\t<\/div>\n<\/div>\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction folderForm( $action, $formHtml ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n\n<div data-controller=\"core.front.messages.folderDialog\" data-action='\nCONTENT;\n$return .= htmlspecialchars( $action, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'>\n\t{$formHtml}\n<\/div>\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction messageList( $baseUrl, $langPrefix, $headers, $mainColumn, $rootButtons, $rows, $sortBy, $sortDirection, $filters, $currentFilter, $pages, $currentPage, $noSort, $quickSearch, $advancedSearch, $classes, $widths ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n<div id='elMessageSidebar' data-controller='core.front.messages.list, core.genericTable' data-baseurl=\"\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"{$baseUrl}\", null, \"\", array(), 0 ) );\n$return .= <<<CONTENT\n\">\n\t<div class='ipsButtonBar ipsPad_half ipsClearfix'>\n\t\t<span class='ipsType_sectionHead'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'menu_messages', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/span>\n\t\t<ul class='ipsButtonRow ipsClearfix ipsPos_right'>\n\t\t\t<li class='ipsPos_left'>\n\t\t\t\t<a class=\"ipsJS_show\" href=\"#elCheck_menu\" id=\"elCheck\" title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'select_rows_tooltip', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n' data-ipsTooltip data-ipsAutoCheck data-ipsAutoCheck-context=\"#elMessageList\" data-ipsMenu data-ipsMenu-activeClass=\"ipsButtonRow_active\">\n\t\t\t\t\t<span class=\"cAutoCheckIcon ipsType_medium\"><i class=\"fa fa-square-o\"><\/i><\/span> <i class=\"fa fa-caret-down\"><\/i>\n\t\t\t\t\t<span class='ipsNotificationCount' data-role='autoCheckCount'>0<\/span>\n\t\t\t\t<\/a>\n\t\t\t\t<ul class=\"ipsMenu ipsMenu_auto ipsMenu_withStem ipsHide\" id=\"elCheck_menu\">\n\t\t\t\t\t<li class=\"ipsMenu_title\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'select_rows', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/li>\n\t\t\t\t\t<li class=\"ipsMenu_item\" data-ipsMenuValue=\"all\"><a href=\"#\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'all', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\t<li class=\"ipsMenu_item\" data-ipsMenuValue=\"none\"><a href=\"#\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'none', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t<\/ul>\n\t\t\t<\/li>\n\t\t\t<li>\n\t\t\t\t<a href='#elSortByMenu_menu' id='elSortByMenu' data-ipsMenu data-ipsMenu-activeClass='ipsButtonRow_active' data-ipsMenu-selectable=\"radio\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'sort_by', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n <i class='fa fa-caret-down'><\/i><\/a>\n\t\t\t\t<ul class='ipsMenu ipsMenu_auto ipsMenu_withStem ipsMenu_selectable ipsHide' id='elSortByMenu_menu'>\n\t\t\t\t\t\nCONTENT;\n\nforeach ( $headers as $k => $header ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\nCONTENT;\n\nif ( in_array( $k, array( 'mt_last_post_time', 'mt_start_time', 'mt_replies' ) ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<li class='ipsMenu_item \nCONTENT;\n\nif ( $k == $sortBy ):\n$return .= <<<CONTENT\nipsMenu_itemChecked\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n' data-ipsMenuValue='recent'><a href='#'>\nCONTENT;\n\n$val = \"{$langPrefix}{$header}\"; $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( $val, \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\t\t<\/ul>\n\t\t\t<\/li>\n\t\t\t<li>\n\t\t\t\t<a href='#elFilterMenu_menu' id='elFilterMenu' data-ipsMenu data-ipsMenu-activeClass='ipsButtonRow_active' data-ipsMenu-selectable=\"radio\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'filter_by', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n <i class='fa fa-caret-down'><\/i><\/a>\n\t\t\t\t<ul class='ipsMenu ipsMenu_auto ipsMenu_withStem ipsMenu_selectable ipsHide' id='elFilterMenu_menu'>\n\t\t\t\t\t<li class='ipsMenu_item \nCONTENT;\n\nif ( !array_key_exists( $currentFilter, $filters ) ):\n$return .= <<<CONTENT\nipsMenu_itemChecked\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n' data-ipsMenuValue='all'><a href='\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"{$baseUrl}&sortby={$sortBy}&sortdirection={$sortDirection}&page=1\", null, \"\", array(), 0 ) );\n$return .= <<<CONTENT\n'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'messenger_filter_all', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\t\nCONTENT;\n\nforeach ( $filters as $k => $q ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<li class='ipsMenu_item \nCONTENT;\n\nif ( $k === $currentFilter ):\n$return .= <<<CONTENT\nipsMenu_itemChecked\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n' data-ipsMenuValue='others'><a href='\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"{$baseUrl}&filter={$k}&sortby={$sortBy}&sortdirection={$sortDirection}&page=1\", null, \"\", array(), 0 ) );\n$return .= <<<CONTENT\n'>\nCONTENT;\n\n$val = \"{$k}\"; $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( $val, \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\t\t\t\t\t\n\t\t\t\t<\/ul>\n\t\t\t<\/li>\n\t\t<\/ul>\n\t<\/div>\n\t<div id='elMessageList' class='ipsClear ipsAreaBackground_light'>\n\t\t<div>\n\t\t\t<ol class='ipsDataList' data-role='messageList'>\n\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"messaging\", \"core\" )->messageListRows( $rows, $mainColumn, $rootButtons, $headers, $langPrefix );\n$return .= <<<CONTENT\n\n\t\t\t<\/ol>\n\t\t<\/div>\n\t<\/div>\n<\/div>\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction messageListRow( $row, $overview ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n\t\t<li class='ipsDataItem ipsClearfix \nCONTENT;\n\nif ( $row['map_has_unread'] ):\n$return .= <<<CONTENT\nipsDataItem_unread\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n cMessage \nCONTENT;\n\nif ( !\\IPS\\Request::i()->overview ):\n$return .= <<<CONTENT\nipsCursor_pointer\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n \nCONTENT;\n\nif ( $row['mt_id'] == \\IPS\\Request::i()->id ):\n$return .= <<<CONTENT\ncMessage_active ipsDataItem_selected\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n' data-messageid='\nCONTENT;\n$return .= htmlspecialchars( $row['map_topic_id'], ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' data-keyNavBlock data-keyAction='return'>\n\t\t\t<div class='ipsDataItem_icon ipsType_center ipsPos_top'>\n\t\t\t\t<div class='ipsSpacer_bottom ipsSpacer_half'>\n\t\t\t\t\t\nCONTENT;\n\nif ( $row['last_message'] ):\n$return .= <<<CONTENT\n\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"global\", \"core\" )->userPhoto( $row['last_message']->author(), 'tiny' );\n$return .= <<<CONTENT\n\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t<\/div>\n\t\t\t\t\nCONTENT;\n\nif ( !isset( \\IPS\\Request::i()->overview ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<span class='ipsCustomInput'>\n\t\t\t\t\t\t<input type='checkbox' data-role='moderation' name=\"moderate[\nCONTENT;\n$return .= htmlspecialchars( $row['map_topic_id'], ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n]\" data-actions='delete' data-state>\n\t\t\t\t\t\t<span><\/span>\n\t\t\t\t\t<\/span>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t<\/div>\n\t\t\t<div class='ipsDataItem_main'>\n\t\t\t\t<h4 class='ipsDataItem_title ipsType_normal ipsType_break'>\n\t\t\t\t\t\nCONTENT;\n\nif ( $overview ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<a href='\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=core&module=messaging&controller=messenger&id={$row['mt_id']}&latest=1\", null, \"messenger_convo\", array(), 0 ) );\n$return .= <<<CONTENT\n' class='cMessageTitle \nCONTENT;\n\nif ( $row['map_has_unread'] ):\n$return .= <<<CONTENT\ncMessageTitle_unread\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n' data-role=\"messageURL\" data-ipsTruncate data-ipsTruncate-type=\"remove\" data-ipsTruncate-size=\"2 lines\">\nCONTENT;\n\nif ( $row['map_has_unread'] ):\n$return .= <<<CONTENT\n\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"global\", \"core\" )->itemIcon( array('type' => 'unread', 'size' => 'tiny') );\n$return .= <<<CONTENT\n \nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\nCONTENT;\n$return .= htmlspecialchars( $row['mt_title'], ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<a href='\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=core&module=messaging&controller=messenger&id={$row['mt_id']}\", null, \"messenger_convo\", array(), 0 ) );\n$return .= <<<CONTENT\n' class='cMessageTitle \nCONTENT;\n\nif ( $row['map_has_unread'] ):\n$return .= <<<CONTENT\ncMessageTitle_unread\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n' data-role=\"messageURL\" data-ipsTruncate data-ipsTruncate-type=\"remove\" data-ipsTruncate-size=\"2 lines\">\nCONTENT;\n\nif ( $row['map_has_unread'] ):\n$return .= <<<CONTENT\n\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"global\", \"core\" )->itemIcon( array('type' => 'unread', 'size' => 'tiny') );\n$return .= <<<CONTENT\n \nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\nCONTENT;\n$return .= htmlspecialchars( $row['mt_title'], ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t<\/h4>\n\t\t\t\t<div class='ipsDataItem_meta ipsType_break' data-ipsTruncate data-ipsTruncate-type=\"remove\" data-ipsTruncate-size=\"1 lines\">\n\t\t\t\t\t\nCONTENT;\n\nif ( $row['last_message'] ):\n$return .= <<<CONTENT\n{$row['last_message']->truncated( TRUE )}\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t<\/div>\n\t\t\t\t<span class='ipsType_light ipsType_medium ipsType_blendLinks'>\nCONTENT;\n$return .= htmlspecialchars( $row['participants'], ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/span>\n\t\t\t<\/div>\n\t\t\t<div class='ipsDataItem_generic ipsDataItem_size2 ipsPos_top ipsType_right'>\n\t\t\t\t<div class='ipsCommentCount ipsSpacer_top ipsSpacer_half' title=\"\nCONTENT;\n\n$pluralize = array( $row['mt_replies'] ); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'messenger_message_count', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), FALSE, array( 'pluralize' => $pluralize ) );\n$return .= <<<CONTENT\n\" data-ipsTooltip>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->formatNumber( $row['mt_replies'] );\n$return .= <<<CONTENT\n<\/div>\n\t\t\t\t<p class='ipsType_reset ipsType_medium ipsType_light ipsType_right'>\n\t\t\t\t\t<span data-ipsTooltip title=\"\nCONTENT;\n\n$sprintf = array(\\IPS\\Member::load( $row['mt_starter_id'] )->name, \\IPS\\DateTime::ts( $row['mt_start_time'] )->relative()); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'messenger_started_by', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n\nCONTENT;\n\nif ( $row['mt_start_time'] !== $row['mt_last_post_time'] AND $row['last_message'] ):\n$return .= <<<CONTENT\n &middot; \nCONTENT;\n\n$sprintf = array($row['last_message']->author()->name, \\IPS\\DateTime::ts( $row['mt_last_post_time'] )->relative()); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'messenger_last_reply', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\">\n\t\t\t\t\t\t\nCONTENT;\n\n$val = ( $row['mt_last_post_time'] instanceof \\IPS\\DateTime ) ? $row['mt_last_post_time'] : \\IPS\\DateTime::ts( $row['mt_last_post_time'] );$return .= $val->html(TRUE, TRUE);\n$return .= <<<CONTENT\n\n\t\t\t\t\t<\/span>\n\t\t\t\t<\/p>\n\t\t\t<\/div>\n\t\t<\/li>\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction messageListRows( $conversations, $pagination=NULL, $overview=FALSE ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n\nCONTENT;\n\nif ( empty( $conversations ) ):\n$return .= <<<CONTENT\n\n\t<li class='ipsDataItem'>\n\t\t<div class='ipsPad ipsType_light ipsType_center ipsType_normal'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'no_results_messages', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/div>\n\t<\/li>\n\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\nCONTENT;\n\nforeach ( $conversations as $row ):\n$return .= <<<CONTENT\n\n\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"messaging\", \\IPS\\Request::i()->app )->messageListRow( $row, $overview );\n$return .= <<<CONTENT\n\n\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction nomessage(  ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n<div class=\"ipsType_center ipsType_large ipsEmpty\">\n\t<i class=\"fa fa-envelope\"><\/i>\n\t<br>\n\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'no_message_selected', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\n<\/div>\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction participant( $map, $conversation ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n<li class='ipsPhotoPanel ipsPhotoPanel_tiny \nCONTENT;\n\nif ( !$map['map_user_active'] or $map['map_user_banned'] ):\n$return .= <<<CONTENT\ncMessage_leftConvo\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n' data-participant=\"\nCONTENT;\n$return .= htmlspecialchars( $map['map_user_id'], ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\">\n\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"global\", \"core\" )->userPhoto( \\IPS\\Member::load( $map['map_user_id'] ), 'tiny' );\n$return .= <<<CONTENT\n\t\n\t<div>\n\t\t\nCONTENT;\n\nif ( $map['map_user_id'] == \\IPS\\Member::loggedIn()->member_id ):\n$return .= <<<CONTENT\n\n\t\t\t<strong>\nCONTENT;\n\n$return .= htmlspecialchars( \\IPS\\Member::load( $map['map_user_id'] )->name, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/strong><br>\n\t\t\nCONTENT;\n\nelseif ( !\\IPS\\Member::load( $map['map_user_id'] )->member_id ):\n$return .= <<<CONTENT\n\n\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'messenger_deleted_member', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<br>\n\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t<a href='#' id='elMessage\nCONTENT;\n$return .= htmlspecialchars( $conversation->id, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_user\nCONTENT;\n$return .= htmlspecialchars( $map['map_user_id'], ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' class=\"cMessage_name\" data-role='userActions' data-username='\nCONTENT;\n\n$return .= htmlspecialchars( \\IPS\\Member::load( $map['map_user_id'] )->name, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' data-ipsMenu><strong>\nCONTENT;\n\n$return .= htmlspecialchars( \\IPS\\Member::load( $map['map_user_id'] )->name, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n <i class='fa fa-caret-down'><\/i><\/strong><\/a><br>\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t<span class='ipsType_light ipsType_small' data-role='userReadInfo'>\n\t\t\t\nCONTENT;\n\nif ( $map['map_user_banned'] ):\n$return .= <<<CONTENT\n\n\t\t\t\t<span class=\"ipsType_warning\"><i class=\"fa fa-ban\"><\/i> \nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'messenger_map_removed', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/span>\n\t\t\t\nCONTENT;\n\nelseif ( !$map['map_user_active'] ):\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\nif ( $map['map_left_time'] ):\n$return .= <<<CONTENT\n\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'messenger_map_left', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\nCONTENT;\n\n$val = ( $map['map_left_time'] instanceof \\IPS\\DateTime ) ? $map['map_left_time'] : \\IPS\\DateTime::ts( $map['map_left_time'] );$return .= $val->html();\n$return .= <<<CONTENT\n\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'messenger_map_left_notime', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\nif ( $map['map_read_time'] ):\n$return .= <<<CONTENT\n\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'messenger_map_read', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\nCONTENT;\n\n$val = ( $map['map_read_time'] instanceof \\IPS\\DateTime ) ? $map['map_read_time'] : \\IPS\\DateTime::ts( $map['map_read_time'] );$return .= $val->html();\n$return .= <<<CONTENT\n\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'messenger_map_not_read', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t<\/span>\n\t<\/div>\n\t\nCONTENT;\n\nif ( $map['map_user_id'] != \\IPS\\Member::loggedIn()->member_id and \\IPS\\Member::load( $map['map_user_id'] )->member_id ):\n$return .= <<<CONTENT\n\n\t\t<ul id='elMessage\nCONTENT;\n$return .= htmlspecialchars( $conversation->id, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_user\nCONTENT;\n$return .= htmlspecialchars( $map['map_user_id'], ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n_menu' class='ipsMenu ipsMenu_auto ipsHide'>\n\t\t\t\nCONTENT;\n\nif ( $conversation->starter_id == \\IPS\\Member::loggedIn()->member_id and ( $map['map_user_active'] or $map['map_user_banned'] ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\nif ( $map['map_user_banned'] ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<li class='ipsMenu_item' data-ipsMenuValue='unblock'><a href='\nCONTENT;\n$return .= htmlspecialchars( $conversation->url('addParticipant')->csrf()->setQueryString( 'member', $map['map_user_id'] ), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'messenger_map_unremove', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t<li class='ipsMenu_item' data-ipsMenuValue='block'><a href='\nCONTENT;\n$return .= htmlspecialchars( $conversation->url('blockParticipant')->csrf()->setQueryString( 'member', $map['map_user_id'] ), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'messenger_map_remove', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t<li class='ipsMenu_sep'><hr><\/li>\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t<li class='ipsMenu_item' data-ipsMenuValue='msg'><a href='\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=core&module=messaging&controller=messenger&do=compose&to={$map['map_user_id']}\", null, \"messenger_compose\", array(), 0 ) );\n$return .= <<<CONTENT\n' data-ipsDialog data-ipsDialog-title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'compose_new', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'messenger_map_message', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t<\/ul>\n\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n<\/li>\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction template( $folder, $folders, $counts, $conversations, $pagination, $conversation, $baseUrl, $baseUrlTemplate, $sortBy, $filter ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n\n<div data-controller='core.front.messages.main, core.front.messages.responsive'>\n\t<div class='ipsPageHeader ipsClearfix ipsPad_half ipsSpacer_bottom' id='elMessageHeader'>\n\t\t<div class='ipsGrid ipsGrid_collapsePhone'>\n\t\t\t<h1 class='ipsType_pageTitle ipsGrid_span6'>\n\t\t\t\t<a href='#elMessageFolders_menu' id='elMessageFolders' data-ipsMenu data-ipsMenu-appendTo=\"#elMessageHeader\" class='ipsType_blendLinks'><span data-role='currentFolder'>\nCONTENT;\n$return .= htmlspecialchars( $folders[ $folder ], ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/span> &nbsp;<i class='fa fa-caret-down'><\/i><\/a>\n\t\t\t\t&nbsp;&nbsp;<a href='#elFolderSettings_menu' id='elFolderSettings' data-ipsMenu data-ipsMenu-appendTo=\"#elMessageHeader\" class='ipsType_blendLinks'><i class='fa fa-cog'><\/i><\/a>\n\t\t\t\t&nbsp;&nbsp;<a href='\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=core&module=messaging&controller=messenger&do=compose\", null, \"messenger_compose\", array(), 0 ) );\n$return .= <<<CONTENT\n' data-ipsDialog data-ipsDialog-url='\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=core&module=messaging&controller=messenger&do=compose\", null, \"messenger_compose\", array(), 0 ) );\n$return .= <<<CONTENT\n' data-ipsDialog-title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'compose_new', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n' class='ipsButton ipsButton_important ipsResponsive_hidePhone'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'compose_new', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\t<a href='\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=core&module=messaging&controller=messenger&do=compose\", null, \"messenger_compose\", array(), 0 ) );\n$return .= <<<CONTENT\n' data-action=\"composeNew\" data-ipsDialog data-ipsDialog-url='\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=core&module=messaging&controller=messenger&do=compose\", null, \"messenger_compose\", array(), 0 ) );\n$return .= <<<CONTENT\n' data-ipsDialog-title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'compose_new', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n' class='ipsButton ipsButton_primary ipsButton_verySmall ipsButton_narrow ipsPos_right ipsResponsive_showPhone ipsResponsive_block'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'new', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\t&nbsp;&nbsp;<span data-role=\"loadingFolderAction\" class='ipsType_light ipsType_normal' style='display: none'><i class='icon-spinner2 ipsLoading_tinyIcon'><\/i> &nbsp;\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'loading', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/span>\n\t\t\t<\/h1>\n\t\t\t\nCONTENT;\n\nif ( \\IPS\\Member::loggedIn()->group['g_max_messages'] ):\n$return .= <<<CONTENT\n\n\t\t\t\t<div class='ipsGrid_span6 ipsResponsive_hidePhone'>\n\t\t\t\t\t<div class='ipsPos_right ipsType_right' data-role=\"quotaTooltip\" data-ipsTooltip data-ipsTooltip-label=\"\nCONTENT;\n\n$sprintf = array(\\IPS\\Member::loggedIn()->group['g_max_messages']); $pluralize = array( array_sum( $counts ) ); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'messenger_quota', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf, 'pluralize' => $pluralize ) );\n$return .= <<<CONTENT\n\">\n\t\t\t\t\t\t\nCONTENT;\n\n$percent = floor( 100 \/ \\IPS\\Member::loggedIn()->group['g_max_messages'] * array_sum( $counts ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<span class=\"ipsAttachment_progress\"><span data-role='quotaWidth' style='width: \nCONTENT;\n\n$return .= htmlspecialchars( $percent > 100 ? 100 : $percent, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n%'><\/span><\/span><br>\n\t\t\t\t\t\t<span class='ipsType_light ipsResponsive_hidePhone'>\nCONTENT;\n\n$sprintf = array($percent); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'messenger_quota_short', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n<\/span>\n\t\t\t\t\t<\/div>\n\t\t\t\t<\/div>\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t<\/div>\n\t\t\n\t\t<ul class='ipsMenu ipsMenu_auto ipsHide' id='elMessageFolders_menu'>\n\t\t\t\nCONTENT;\n\nforeach ( $folders as $id => $name ):\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\nif ( $id === 'myconvo' ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<li class='ipsMenu_item' data-ipsMenuValue='\nCONTENT;\n$return .= htmlspecialchars( $id, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'><a href='\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=core&module=messaging&controller=messenger\", null, \"messaging\", array(), 0 ) );\n$return .= <<<CONTENT\n'><span class='ipsMenu_itemCount'>\nCONTENT;\n\nif ( isset( $counts[ $id ] ) ):\n$return .= <<<CONTENT\n\nCONTENT;\n$return .= htmlspecialchars( $counts[ $id ], ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n0\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n<\/span> <span data-role='folderName'>\nCONTENT;\n$return .= htmlspecialchars( $name, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/span><\/a><\/li>\n\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t<li class='ipsMenu_item' data-ipsMenuValue='\nCONTENT;\n$return .= htmlspecialchars( $id, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'><a href='\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=core&module=messaging&controller=messenger&folder={$id}\", null, \"messaging\", array(), 0 ) );\n$return .= <<<CONTENT\n'><span class='ipsMenu_itemCount'>\nCONTENT;\n\nif ( isset( $counts[ $id ] ) ):\n$return .= <<<CONTENT\n\nCONTENT;\n$return .= htmlspecialchars( $counts[ $id ], ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n0\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n<\/span> <span data-role='folderName'>\nCONTENT;\n$return .= htmlspecialchars( $name, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/span><\/a><\/li>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\t<li class='ipsPad_half'><a class='ipsButton ipsButton_fullWidth ipsButton_light ipsButton_small' href=\"\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=core&module=messaging&controller=messenger&do=addFolder\", null, \"\", array(), 0 ) );\n$return .= <<<CONTENT\n\" data-action=\"addFolder\" id='elAddFolder'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'messenger_add_folder', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t<\/ul>\n\t\t<ul class='ipsMenu ipsMenu_auto ipsHide' id='elFolderSettings_menu'>\n\t\t\t<li class='ipsMenu_title'>\nCONTENT;\n\n$sprintf = array($folders[ $folder ]); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'messenger_action_with', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n<\/li>\n\t\t\t<li class='ipsMenu_item' data-ipsMenuValue='markRead'><a href='\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=core&module=messaging&controller=messenger&do=readFolder&folder={$folder}\" . \"&csrfKey=\" . \\IPS\\Session::i()->csrfKey, null, \"\", array(), 0 ) );\n$return .= <<<CONTENT\n'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'messenger_action_read', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t<li class='ipsMenu_item \nCONTENT;\n\nif ( $folder == 'myconvo' ):\n$return .= <<<CONTENT\nipsMenu_itemDisabled ipsHide\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n' data-ipsMenuValue='rename' id='elFolderRename'><a href='\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=core&module=messaging&controller=messenger&do=renameFolder&folder={$folder}\" . \"&csrfKey=\" . \\IPS\\Session::i()->csrfKey, null, \"\", array(), 0 ) );\n$return .= <<<CONTENT\n'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'messenger_action_rename', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t<li class='ipsMenu_item' data-ipsMenuValue='empty'><a href='\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=core&module=messaging&controller=messenger&do=emptyFolder&folder={$folder}\" . \"&csrfKey=\" . \\IPS\\Session::i()->csrfKey, null, \"\", array(), 0 ) );\n$return .= <<<CONTENT\n'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'messenger_action_empty', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t<li class='ipsMenu_item \nCONTENT;\n\nif ( $folder == 'myconvo' ):\n$return .= <<<CONTENT\nipsMenu_itemDisabled ipsHide\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n' data-ipsMenuValue='delete'><a href='\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=core&module=messaging&controller=messenger&do=deleteFolder&folder={$folder}\" . \"&csrfKey=\" . \\IPS\\Session::i()->csrfKey, null, \"\", array(), 0 ) );\n$return .= <<<CONTENT\n'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'messenger_action_delete_folder', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t<\/ul>\n\t<\/div>\n\n\t<div class='ipsColumns ipsColumns_collapseTablet' data-ipsFilterBar data-ipsFilterBar-on='phone,tablet' data-ipsFilterBar-viewDefault='\nCONTENT;\n\nif ( \\IPS\\Request::i()->id && !isset( \\IPS\\Request::i()->_list) ):\n$return .= <<<CONTENT\nfilterContent\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\nfilterBar\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n'>\n\t\t<div class='ipsColumn ipsColumn_veryWide' data-role='filterBar'>\n\t\t\t<div id='elMessageSidebar' class='ipsBox' data-controller='core.front.messages.list' data-folderID='\nCONTENT;\n$return .= htmlspecialchars( $folder, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'\n\t\t\t\tdata-ipsInfScroll\n\t\t\t\tdata-ipsInfScroll-scrollScope='#elMessageList'\n\t\t\t\tdata-ipsInfScroll-container='#elMessageList [data-role=\"messageList\"]'\n\t\t\t\tdata-ipsInfScroll-url='\nCONTENT;\n$return .= htmlspecialchars( $baseUrl->setQueryString( array( 'sortBy' => $sortBy, 'filter' => $filter ) )->stripQueryString( 'id' ), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'\n\t\t\t\tdata-ipsInfScroll-pageParam='listPage'\n\t\t\t>\n\t\t\t\t<h2 class='ipsType_sectionTitle ipsType_reset'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'menu_messages', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h2>\n\t\t\t\t\nCONTENT;\n\nif ( \\IPS\\Request::i()->q ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<p class='ipsMessage ipsMessage_info ipsType_reset'>\nCONTENT;\n\n$sprintf = array(\\IPS\\Request::i()->q); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'messenger_filtering', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n<\/p>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t<div class='ipsButtonBar ipsPad_half ipsClearfix' data-role=\"messageListFilters\">\n\t\t\t\t\t<ul class='ipsButtonRow ipsClearfix'>\n\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t<a class=\"ipsJS_show\" href=\"#elCheck_menu\" id=\"elCheck\" title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'select_rows_tooltip', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n' data-ipsTooltip data-ipsAutoCheck data-ipsAutoCheck-context=\"#elMessageList\" data-ipsMenu data-ipsMenu-activeClass=\"ipsButtonRow_active\">\n\t\t\t\t\t\t\t\t<span class=\"cAutoCheckIcon ipsType_medium\"><i class=\"fa fa-square-o\"><\/i><\/span> <i class=\"fa fa-caret-down\"><\/i>\n\t\t\t\t\t\t\t\t<span class='ipsNotificationCount' data-role='autoCheckCount'>0<\/span>\n\t\t\t\t\t\t\t<\/a>\n\t\t\t\t\t\t\t<ul class=\"ipsMenu ipsMenu_auto ipsMenu_withStem ipsHide\" id=\"elCheck_menu\">\n\t\t\t\t\t\t\t\t<li class=\"ipsMenu_title\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'select_rows', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/li>\n\t\t\t\t\t\t\t\t<li class=\"ipsMenu_item\" data-ipsMenuValue=\"all\"><a href=\"#\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'all', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\t\t\t\t<li class=\"ipsMenu_item\" data-ipsMenuValue=\"none\"><a href=\"#\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'none', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\t\t\t<\/ul>\n\t\t\t\t\t\t<\/li>\n\t\t\t\t\t<\/ul>\n\t\t\t\t\t<ul class='ipsButtonRow ipsPos_right ipsClearfix'>\n\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t<a href='#elSortByMenu_menu' id='elSortByMenu' data-ipsMenu data-ipsMenu-activeClass='ipsButtonRow_active' data-ipsMenu-selectable=\"radio\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'sort_by', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n <i class='fa fa-caret-down'><\/i><\/a>\n\t\t\t\t\t\t\t<ul class='ipsMenu ipsMenu_auto ipsMenu_withStem ipsMenu_selectable ipsHide' id='elSortByMenu_menu'>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nforeach ( array( 'mt_last_post_time', 'mt_start_time', 'mt_replies' ) as $k ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<li class='ipsMenu_item \nCONTENT;\n\nif ( $k == \\IPS\\Request::i()->sortBy or ( !\\IPS\\Request::i()->sortBy and $k === 'mt_last_post_time') ):\n$return .= <<<CONTENT\nipsMenu_itemChecked\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n' data-ipsMenuValue='\nCONTENT;\n$return .= htmlspecialchars( $k, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'><a href='\nCONTENT;\n$return .= htmlspecialchars( $baseUrl->setQueryString( array( 'sortBy' => $k, 'filter' => $filter ) ), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'>\nCONTENT;\n\n$val = \"{$k}\"; $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( $val, \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<\/ul>\n\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t<a href='#elFilterMenu_menu' id='elFilterMenu' data-ipsMenu data-ipsMenu-activeClass='ipsButtonRow_active' data-ipsMenu-selectable=\"radio\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'filter_by', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n <i class='fa fa-caret-down'><\/i><\/a>\n\t\t\t\t\t\t\t<ul class='ipsMenu ipsMenu_auto ipsMenu_withStem ipsMenu_selectable ipsHide' id='elFilterMenu_menu'>\n\t\t\t\t\t\t\t\t<li class='ipsMenu_item \nCONTENT;\n\nif ( !\\IPS\\Request::i()->filter ):\n$return .= <<<CONTENT\nipsMenu_itemChecked\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n' data-ipsMenuValue='all'><a href='\nCONTENT;\n$return .= htmlspecialchars( $baseUrl->setQueryString( array( 'sortBy' => $sortBy ) ), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'messenger_filter_all', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nforeach ( array( 'mine', 'not_mine' ) as $k ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<li class='ipsMenu_item \nCONTENT;\n\nif ( $k === \\IPS\\Request::i()->filter or ( !\\IPS\\Request::i()->filter and $k === 'all' ) ):\n$return .= <<<CONTENT\nipsMenu_itemChecked\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n' data-ipsMenuValue='\nCONTENT;\n$return .= htmlspecialchars( $k, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'><a href='\nCONTENT;\n$return .= htmlspecialchars( $baseUrl->setQueryString( array( 'sortBy' => $sortBy, 'filter' => $k ) ), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'>\nCONTENT;\n\n$val = \"messenger_filter_{$k}\"; $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( $val, \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<\/ul>\n\t\t\t\t\t\t<\/li>\n\t\t\t\t\t<\/ul>\n\t\t\t\t<\/div>\n\t\t\t\t<div id='elMessageList' class='ipsClear ipsScrollbar ipsAreaBackground_light'>\n\t\t\t\t\t<form action=\"\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=core&module=messaging&controller=messenger\" . \"&csrfKey=\" . \\IPS\\Session::i()->csrfKey, null, \"messenger\", array(), 0 ) );\n$return .= <<<CONTENT\n\" method=\"post\" data-role='moderationTools' data-ipsPageAction>\n\t\t\t\t\t\t<ol class='ipsDataList' data-role='messageList' data-ipsKeyNav data-ipsKeyNav-observe='return'>\n\t\t\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"messaging\", \"core\" )->messageListRows( $conversations );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<\/ol>\n\t\t\t\t\t\t<noscript><div class=\"ipsPad\">{$pagination}<\/div><\/noscript>\n\t\t\t\t\t\t<div class=\"ipsAreaBackground ipsPad ipsClearfix\" data-role=\"pageActionOptions\">\n\t\t\t\t\t\t\t<div class=\"ipsPos_right\">\n\t\t\t\t\t\t\t\t<select name=\"modaction\" data-role=\"moderationAction\">\n\t\t\t\t\t\t\t\t\t<option value='delete' data-icon='trash'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'messenger_leave', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/option>\n\t\t\t\t\t\t\t\t<\/select>\n\t\t\t\t\t\t\t\t<button type=\"submit\" class=\"ipsButton ipsButton_alternate ipsButton_verySmall\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'submit', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/button>\n\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t<\/form>\n\t\t\t\t<\/div>\n\t\t\t\t<div class='ipsResponsive_showPhone ipsResponsive_block ipsAreaBackground_light ipsPad'>\n\t\t\t\t\t{$pagination}\n\t\t\t\t<\/div>\n\t\t\t\t<div class='ipsAreaBackground ipsPad' id='elMessageSearch'>\n\t\t\t\t\t<form accept-charset='utf-8' method='post' action=\"\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=core&module=messaging&controller=messenger\", null, \"messenger\", array(), 0 ) );\n$return .= <<<CONTENT\n\" data-role='messageSearch'>\n\t\t\t\t\t\t<a href='#' data-action='messageSearchCancel' class='ipsHide'><i class='fa fa-times'><\/i><\/a>\n\t\t\t\t\t\t<input type='text' data-role='messageSearchText' class='ipsField_fullWidth' name='q' placeholder='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'messenger_search', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n' value=\"\nCONTENT;\n\n$return .= htmlspecialchars( \\IPS\\Request::i()->q, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\">\n\t\t\t\t\t<\/form>\n\t\t\t\t<\/div>\n\t\t\t<\/div>\n\n\t\t\t<p class='ipsType_right ipsType_medium'>\n\t\t\t\t<a href='\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=core&module=messaging&controller=messenger&do=disableMessenger\" . \"&csrfKey=\" . \\IPS\\Session::i()->csrfKey, null, \"messenger\", array(), 0 ) );\n$return .= <<<CONTENT\n' data-confirm>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'disable_messenger', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t<\/p>\n\t\t<\/div>\n\t\t<div class='ipsColumn ipsColumn_fluid' data-role='filterContent'>\n\t\t\t<div id='elMessageViewer' data-controller='core.front.messages.view' \nCONTENT;\n\nif ( $conversation !== NULL ):\n$return .= <<<CONTENT\ndata-current-id=\"\nCONTENT;\n$return .= htmlspecialchars( $conversation->id, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\"\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n>\n\t\t\t\t\nCONTENT;\n\nif ( $conversation === NULL ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"messaging\", \\IPS\\Request::i()->app )->nomessage(  );\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"messaging\", \\IPS\\Request::i()->app )->conversation( $conversation, $folders );\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t<\/div>\n\t\t<\/div>\n\t<\/div>\n\n\t\nCONTENT;\n\nif ( \\IPS\\Member::loggedIn()->group['g_max_messages'] ):\n$return .= <<<CONTENT\n\n\t\t<div class='ipsResponsive_showPhone ipsResponsive_block'>\n\t\t\t<div class='ipsType_center' data-role=\"quotaTooltip\">\n\t\t\t\t<span class=\"ipsAttachment_progress\"><span data-role='quotaWidth' style='width: \nCONTENT;\n\n$return .= htmlspecialchars( 100 \/ \\IPS\\Member::loggedIn()->group['g_max_messages'] * array_sum( $counts ), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n%'><\/span><\/span><br>\n\t\t\t\t<span class='ipsType_light ipsResponsive_showPhone ipsResponsive_inline'>\nCONTENT;\n\n$sprintf = array(100 \/ \\IPS\\Member::loggedIn()->group['g_max_messages'] * array_sum( $counts )); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'messenger_quota_short', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n<\/span>\n\t\t\t<\/div>\n\t\t<\/div>\n\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\n\t<div id='elFolderRename_content' style='display: none' data-controller=\"core.front.messages.folderDialog\" data-type='rename'>\n\t\t<form action='#' method='get'>\n\t\t\t<div class='ipsPad'>\n\t\t\t\t<input type='text' class='ipsField_primary ipsField_fullWidth' data-role=\"folderName\">\n\t\t\t<\/div>\n\t\t\t<div class='ipsAreaBackground ipsPad ipsType_right'>\n\t\t\t\t<button type='submit' class='ipsButton ipsButton_primary' data-action='saveFolderName'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'save', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/button>\n\t\t\t<\/div>\n\t\t<\/form>\n\t<\/div>\n\n\t<div id='elAddFolder_content' style='display: none' data-controller=\"core.front.messages.folderDialog\" data-type='add'>\n\t\t<form action='#' method='get'>\n\t\t\t<div class='ipsPad'>\n\t\t\t\t<input type='text' class='ipsField_primary ipsField_fullWidth' data-role=\"folderName\" placeholder=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'messenger_add_folder_name', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\">\n\t\t\t<\/div>\n\t\t\t<div class='ipsAreaBackground ipsPad ipsType_right'>\n\t\t\t\t<button type='submit' class='ipsButton ipsButton_primary' data-action='saveFolderName'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'messenger_add_folder', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/button>\n\t\t\t<\/div>\n\t\t<\/form>\n\t<\/div>\n<\/div>\n\nCONTENT;\n\n\t\treturn $return;\n}}"
VALUE;
